#!/bin/bash

# Sunucuda hangi Squid sÃ¼rÃ¼mÃ¼nÃ¼n kurulu olduÄŸunu kontrol et (squid veya squid3).
if [ -d "/etc/squid/" ]; then
    # Alan adlarÄ±nÄ±n tutulduÄŸu dosyanÄ±n yolunu belirle.
    payload="/etc/squid/payload.txt"
elif [ -d "/etc/squid3/" ]; then
    payload="/etc/squid3/payload.txt"
fi

# Mavi arka plan Ã¼zerine beyaz ve kalÄ±n bir baÅŸlÄ±k yazdÄ±r.
tput setaf 7 ; tput setab 4 ; tput bold ; printf '%35s%s%-10s\n' "ã…¤ğŸ‰ã…¤Squid Proxy'den Host Silmeã…¤ğŸ‰ã…¤" ; tput sgr0

# Payload dosyasÄ± mevcut deÄŸilse hata ver ve Ã§Ä±k.
if [ ! -f "$payload" ]; then
    tput setaf 7 ; tput setab 4 ; tput bold ; echo "" ; echo "$payload DosyasÄ± BulunamadÄ±" ; tput sgr0
    exit 1
else
    # EÄŸer dosya mevcutsa, iÃ§indeki mevcut alan adlarÄ±nÄ± gÃ¶ster.
    tput setaf 2 ; tput bold ; echo ""; echo "$payload dosyasÄ±ndaki mevcut alan adlarÄ±:" ; tput sgr0
    tput setaf 3 ; tput bold ; echo "" ; cat $payload ; echo "" ; tput sgr0
    
    # KullanÄ±cÄ±dan kaldÄ±rmak istediÄŸi alan adÄ±nÄ± girmesini iste.
    read -p "Listeden kaldÄ±rmak istediÄŸiniz alan adÄ±nÄ± girin: " host
    
    # EÄŸer kullanÄ±cÄ± hiÃ§bir ÅŸey girmeden Enter'a basarsa...
    if [[ -z $host ]]; then
        tput setaf 7 ; tput setab 4 ; tput bold ; echo "" ; echo "BoÅŸ veya geÃ§ersiz bir alan adÄ± girdiniz!" ; echo "" ; tput sgr0
        exit 1
    else
        # EÄŸer girilen alan adÄ± dosyada bulunmuyorsa...
        if [[ `grep -c "^$host" $payload` -ne 1 ]]; then
            tput setaf 7 ; tput setab 4 ; tput bold ; echo "" ; echo "$host alan adÄ± $payload dosyasÄ±nda bulunamadÄ±" ; echo "" ; tput sgr0
            exit 1
        else
            # Alan adÄ±nÄ± dosyadan sil (grep -v komutu belirtilen satÄ±r DIÅINDAKÄ° tÃ¼m satÄ±rlarÄ± tutar).
            grep -v "^$host" $payload > /tmp/a && mv /tmp/a $payload
            
            # BaÅŸarÄ±lÄ± olduÄŸuna dair mesaj gÃ¶ster ve dosyanÄ±n son halini yazdÄ±r.
            tput setaf 7 ; tput setab 1 ; tput bold ; echo "" ; echo "$payload dosyasÄ± gÃ¼ncellendi, alan adÄ± baÅŸarÄ±yla kaldÄ±rÄ±ldÄ±:" ; tput sgr0
            tput setaf 3 ; tput bold ; echo "" ; cat $payload ; echo "" ; tput sgr0
            
            # DeÄŸiÅŸikliklerin aktif olmasÄ± iÃ§in Squid servisini yeniden yÃ¼kle.
            if [ -f "/etc/init.d/squid3" ]; then
                service squid3 reload
            elif [ -f "/etc/init.d/squid" ]; then
                service squid reload
            fi  
            
            # Son olarak servisin yeniden yÃ¼klendiÄŸini bildir.
            tput setaf 7 ; tput setab 1 ; tput bold ; echo "" ; echo "Squid Proxy baÅŸarÄ±yla yeniden yÃ¼klendi!" ; echo "" ; tput sgr0
            exit 1
        fi
    fi
fi
#!/bin/bash
# 'bot_gen' adÄ±nda bir screen oturumunun Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± kontrol et.
if [[ $(screen -list| grep -c 'bot_gen') == '0' ]]; then
    # --- BOT AKTÄ°VASYON BÃ–LÃœMÃœ ---
    clear
    # BaÅŸlÄ±k metnini mavi arka plan Ã¼zerine beyaz ve kalÄ±n olarak yazdÄ±r.
    echo -e "\E[44;1;37m      ã…¤ğŸ‰ã…¤Cyux VPS YÃ¶neticisi Telegram Bot Aktivasyonuã…¤ğŸ‰ã…¤      \E[0m"
    echo ""
    
    # KullanÄ±cÄ±dan Telegram Bot Token'Ä±nÄ± iste.
    echo -ne "\033[1;32mâ—‡ @BotFather'dan AldÄ±ÄŸÄ±nÄ±z Bot Token'Ä±nÄ± Girin\033[1;37m: "; read token
    echo ""
    
    # KullanÄ±cÄ±dan Telegram ID'sini iste.
    echo -ne "\033[1;32mâ—‡ Telegram ID'nizi Girin\033[1;37m: "; read idtelegram
    
    # Bot'un bulunduÄŸu dizine git.
    cd /etc/VPSManager
    
    # Bot script'ini 'bot_gen' adÄ±yla yeni bir screen oturumunda baÅŸlat.
    # Token ve ID, script'e argÃ¼man olarak verilir.
    screen -dmS bot_gen ./botgerador $token $idtelegram > /dev/null 2>&1
    
    # Bot'un sistem yeniden baÅŸladÄ±ÄŸÄ±nda otomatik olarak Ã§alÄ±ÅŸmasÄ± iÃ§in /etc/autostart dosyasÄ±na ekle.
    if [[ $(grep -wc "bot_gen" /etc/autostart) = '0' ]]; then
        # EÄŸer satÄ±r yoksa, ekle.
        echo -e "ps x | grep 'bot_gen' | grep -v 'grep' || (cd /etc/VPSManager && sudo screen -dmS bot_gen ./botgerador $token $idtelegram && cd $HOME)" >> /etc/autostart
    else
        # EÄŸer satÄ±r zaten varsa, eskisini silip yenisini (gÃ¼ncel token/ID ile) ekle.
        sed -i '/bot_gen/d' /etc/autostart
        echo -e "ps x | grep 'bot_gen' | grep -v 'grep' || (cd /etc/VPSManager && sudo screen -dmS bot_gen ./botgerador $token $idtelegram && cd $HOME)" >> /etc/autostart
    fi
    
    # BaÅŸarÄ± mesajÄ±nÄ± gÃ¶ster.
    clear && echo "â—‡ BOT BAÅARIYLA AKTÄ°F EDÄ°LDÄ°!"

else
    # --- BOT DEVRE DIÅI BIRAKMA BÃ–LÃœMÃœ ---
    # EÄŸer 'bot_gen' screen oturumu zaten Ã§alÄ±ÅŸÄ±yorsa, onu sonlandÄ±r.
    screen -r -S "bot_gen" -X quit
    
    # BaÅŸarÄ± mesajÄ±nÄ± gÃ¶ster.
    clear && echo "â—‡ BOT BAÅARIYLA DEVRE DIÅI BIRAKILDI!"
fi
#!/bin/bash
clear
# BetiÄŸin 'root' kullanÄ±cÄ±sÄ± ile Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nÄ± kontrol et.
[[ "$(whoami)" != "root" ]] && {
    echo -e "\033[1;33m[\033[1;31mHata\033[1;33m] \033[1;37m- \033[1;33mâ—‡ BU BETÄ°ÄžÄ° ROOT OLARAK Ã‡ALIÅžTIRMANIZ GEREKÄ°R!\033[0m"
    rm $HOME/hehe > /dev/null 2>&1; exit 0
}

# --- YENÄ° ADRESÄ°N TANIMLANMASI (Kendi projenin adresi) ---
# Orijinal betikteki bu Ã¶zel deÄŸiÅŸkenleri betik iÃ§ine gÃ¶mÃ¼yoruz.
# ArtÄ±k bu adresi her yerde senin GitHub adresinle deÄŸiÅŸtireceÄŸiz.
GITHUB_USER="selmandemir"
GITHUB_REPO="cyux-vps-yoneticisi"
GITHUB_RAW="https://raw.githubusercontent.com/$GITHUB_USER/$GITHUB_REPO/main"

# --- FONKSÄ°YON: Arka planda bir komut Ã§alÄ±ÅŸtÄ±rÄ±rken bekleme animasyonu gÃ¶sterir ---
fun_bar () {
    comando[0]="$1"
    comando[1]="$2"
    (
        [[ -e $HOME/fim ]] && rm $HOME/fim
        ${comando[0]} -y > /dev/null 2>&1
        ${comando[1]} -y > /dev/null 2>&1
        touch $HOME/fim
    ) > /dev/null 2>&1 &
    tput civis
    echo -ne "  \033[1;33mâ—‡ LÃœTFEN BEKLEYÄ°N... \033[1;37m- \033[1;33m["
    while true; do
        for((i=0; i<18; i++)); do
            echo -ne "\033[1;31m#"
            sleep 0.1s
        done
        [[ -e $HOME/fim ]] && rm $HOME/fim && break
        echo -e "\033[1;33m]"
        sleep 1s
        tput cuu1
        tput dl1
        echo -ne "  \033[1;33mâ—‡ LÃœTFEN BEKLEYÄ°N... \033[1;37m- \033[1;33m["
    done
    echo -e "\033[1;33m]\033[1;37m -\033[1;32mâ—‡ TAMAMLANDI!\033[1;37m"
    tput cnorm
}

# --- BaÅŸlangÄ±Ã§ EkranÄ± ---
tput setaf 7 ; tput setab 4 ; tput bold ; printf '%40s%s%-12s\n' "â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€ã…¤ðŸ‰ã…¤Cyux VPS YÃ¶neticisi'ne HoÅŸ Geldinizã…¤ðŸ‰ã…¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡" ; tput sgr0
echo -e "\033[1;31mâ—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡\033[0m"
# ... (TÃ¼rkÃ§e HoÅŸ Geldiniz MesajlarÄ±) ...
echo -ne "\033[1;36mâ—‡ Devam etmek istiyor musunuz? [E/H]: \033[1;37m"; read x
[[ $x = @(h|H) ]] && exit

# --- ANAHTAR DOÄžRULAMA ADIMLARI SÄ°LÄ°NDÄ° VEYA DEVRE DIÅžI BIRAKILDI ---
# ... (Bu bÃ¶lÃ¼mdeki kodlar, betiÄŸin baÅŸka bir kaynaktan anahtar indirmesini engeller) ...

echo -e "\n\033[1;32mâ—‡ KURULUM BAÅžLATILIYOR...\033[1;32m"
sleep 1s
echo ""

# --- Mevcut KullanÄ±cÄ± VeritabanÄ± KontrolÃ¼ ---
# ... (KullanÄ±cÄ± veritabanÄ± koruma/oluÅŸturma mantÄ±ÄŸÄ±) ...
[[ -f "$HOME/usuarios.db" ]] && {
    clear
    echo -e "\n\033[0;34mâ—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡\033[0m"
    echo ""
    echo -e "                \033[1;33mâ€¢ \033[1;31mâ—‡ DÄ°KKAT!\033[1;33mâ€¢ \033[0m"
    echo ""
    echo -e "\033[1;33mBir KullanÄ±cÄ± VeritabanÄ± \033[1;32m(usuarios.db) \033[1;33mbulundu!"
    echo -e "KullanÄ±cÄ±larÄ±n eÅŸ zamanlÄ± baÄŸlantÄ± limitini koruyarak"
    echo -e "mevcut veritabanÄ±nÄ± tutmak mÄ±, yoksa yeni bir"
    echo -e "veritabanÄ± oluÅŸturmak mÄ± istersiniz?\033[0m"
    echo -e "\n\033[1;37m[\033[1;31m1\033[1;37m] \033[1;33mMevcut VeritabanÄ±nÄ± Koru\033[0m"
    echo -e "\033[1;37m[\033[1;31m2\033[1;37m] \033[1;33mYeni Bir VeritabanÄ± OluÅŸtur\033[0m"
    echo -e "\n\033[0;34mâ—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡\033[0m"
    echo ""
    tput setaf 2 ; tput bold ; read -p "SeÃ§enek ?: " -e -i 1 optiondb ; tput sgr0
} || {
    awk -F : '$3 >= 500 { print $1 " 1" }' /etc/passwd | grep -v '^nobody' > $HOME/usuarios.db
}
[[ "$optiondb" = '2' ]] && awk -F : '$3 >= 500 { print $1 " 1" }' /etc/passwd | grep -v '^nobody' > $HOME/usuarios.db
clear

# --- Sistem GÃ¼ncelleme ve Paket Kurulumu ---
tput setaf 7 ; tput setab 4 ; tput bold ; printf '%35s%s%-18s\n' "â—‡ KURULUM Ä°Ã‡Ä°N BEKLEYÄ°N." ; tput sgr0
echo ""
echo -e "              \033[1;33m[\033[1;31m!\033[1;33m] \033[1;32mâ—‡ SÄ°STEM GÃœNCELLENÄ°YOR...\033[1;33m[\033[1;31m!\033[1;33m]\033[0m"
echo ""
echo -e "    \033[1;33mâ—‡ GÃœNCELLEMELER GENELLÄ°KLE BÄ°RAZ ZAMAN ALIR!\033[0m"
echo ""
fun_bar 'apt-get update'
clear
echo ""
echo -e "              \033[1;33m[\033[1;31m!\033[1;33m] \033[1;32mâ—‡ PAKETLER YÃœKLENÄ°YOR\033[1;33m[\033[1;31m!\033[1;33m] \033[0m"
echo ""
echo -e "\033[1;33mâ—‡ BAZI PAKETLERÄ°N YÃœKLENMESÄ° KESÄ°NLÄ°KLE GEREKLÄ°DÄ°R!\033[0m"
echo ""
inst_pct() {
    _pacotes=("bc" "apache2" "cron" "screen" "nano" "unzip" "lsof" "netstat" "net-tools" "dos2unix" "nload" "jq" "curl" "figlet" "python3" "python-pip")
    for _prog in ${_pacotes[@]}; do
        apt install $_prog -y
    done
    pip install speedtest-cli
}
fun_bar 'inst_pct'
# Gerekli portlar iÃ§in gÃ¼venlik duvarÄ± kurallarÄ±nÄ± ekle.
[[ -f "/usr/sbin/ufw" ]] && ufw allow 443/tcp ; ufw allow 80/tcp ; ufw allow 3128/tcp ; ufw allow 8799/tcp ; ufw allow 8080/tcp
clear

# --- Kurulumu Tamamlama ---
echo ""
echo -e "                \033[1;33m[\033[1;31m!\033[1;33m] \033[1;32mâ—‡ BÄ°TÄ°RÄ°LÄ°YOR...\033[1;33m[\033[1;31m!\033[1;33m] \033[0m"
echo ""
echo -e "      \033[1;33mâ—‡ FONKSÄ°YONLAR VE AYARLAR TAMAMLANIYOR!\033[0m"
echo ""
# Gerekli modÃ¼lleri ve dosyalarÄ± indiren ana komutu Ã§alÄ±ÅŸtÄ±r.
# Bu satÄ±r, artÄ±k senin GitHub adresini kullanarak projenin alt modÃ¼llerini indirecektir.
fun_bar "$GITHUB_RAW/Install/list $GITHUB_RAW/Install/hehe $GITHUB_RAW/Install/list $GITHUB_RAW/Install/versao $key"
clear
echo ""
IP=$(wget -qO- ipv4.icanhazip.com)
echo -e "        \033[1;33m \033[1;32mâ—‡ KURULUM TAMAMLANDI.â—‡\033[1;33m \033[0m"
echo ""
echo -e "\033[1;31m\033[1;33mâ—‡ ANA KOMUT:- \033[1;32mmenu\033[0m"
echo -e "\033[1;33mâ—‡ DAHA FAZLA BÄ°LGÄ° \033[1;31m(\033[1;36mâ—‡ TELEGRAM\033[1;31m): \033[1;37m@selmandemir \033[1;31m( \033[1;36m https://t.me/s/selmandemir \033[1;31m )\033[0m"
echo ""
echo -e "\033[1;31m \033[1;33mâ—‡--Ä°PUCU!--â—‡\033[1;36mã…¤--Bu URL'yi kullanarak sunucudaki Ã§evrimiÃ§i kullanÄ±cÄ± sayÄ±sÄ±nÄ± kolayca gÃ¶rebilirsiniz.\033[0m"
echo -e " http://$IP:8888/server/online"
echo ""
# Kurulum sonrasÄ± temizlik.
rm $HOME/hehe && cat /dev/null > ~/.bash_history && history -c
#!/bin/bash
clear
# BetiÄŸin 'root' kullanÄ±cÄ±sÄ± ile Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nÄ± kontrol et.
[[ "$(whoami)" != "root" ]] && {
    echo -e "\033[1;33m[\033[1;31mHata\033[1;33m] \033[1;37m- \033[1;33mâ—‡ BU BETÄ°ÄžÄ° ROOT OLARAK Ã‡ALIÅžTIRMANIZ GEREKÄ°R!\033[0m"
    rm $HOME/hehe > /dev/null 2>&1; exit 0
}

# --- FONKSÄ°YON: Arka planda bir komut Ã§alÄ±ÅŸtÄ±rÄ±rken bekleme animasyonu gÃ¶sterir ---
fun_bar () {
    # ... (Bu fonksiyon, iÅŸlemin devam ettiÄŸini belirten bir ilerleme Ã§ubuÄŸu animasyonu gÃ¶sterir) ...
    echo -ne "  \033[1;33mâ—‡ LÃœTFEN BEKLEYÄ°N... \033[1;37m- \033[1;33m["
    # ...
    echo -e "\033[1;33m]\033[1;37m -\033[1;32mâ—‡ TAMAMLANDI!\033[1;37m"
}

# --- FONKSÄ°YON: Lisans anahtarÄ±nÄ± doÄŸrular ---
function verif_key () {
    # ... (Bu bÃ¶lÃ¼m, betiÄŸin lisansÄ±nÄ± kontrol etmek iÃ§in kullanÄ±lÄ±r) ...
    [[ ! -e "$_Ink/list" ]] && {
        echo -e "\n\033[1;31mâ—‡ GEÃ‡ERSÄ°Z ANAHTAR!\033[0m"
        rm -rf $HOME/hehe > /dev/null 2>&1
        sleep 2; clear; exit 1
    }
}

# --- Kurulum BaÅŸlangÄ±Ã§ EkranÄ± ---
tput setaf 7 ; tput setab 4 ; tput bold ; printf '%40s%s%-12s\n' "â—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€ã…¤ðŸ‰ã…¤Cyux VPS YÃ¶neticisi'ne HoÅŸ Geldinizã…¤ðŸ‰ã…¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡" ; tput sgr0
echo -e "\033[1;31mâ—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡\033[0m"
echo ""
echo -e "\033[1;31mâ—‡ DÄ°KKAT!ã…¤âš ï¸ã…¤.\033[1;33mã…¤BU SCRIPT AÅžAÄžIDAKÄ°LERÄ° Ä°Ã‡ERÄ°R!!\033[0m"
echo ""
echo -e "\033[1;31mâ—‡ \033[1;33mAÄž, SÄ°STEM VE KULLANICI YÃ–NETÄ°MÄ° Ä°Ã‡Ä°N BÄ°R DÄ°ZÄ° ARAÃ‡ SCRIPT'Ä° KURULACAKTIR.\033[0m"
echo ""
echo -e "\033[1;32mâ—‡ \033[1;32mÄ°PUCU! \033[1;33mDAHA Ä°YÄ° BÄ°R DENEYÄ°M VE GÃ–RÃœNÃœM Ä°Ã‡Ä°N TERMÄ°NALÄ°NÄ°ZDE KOYU TEMA KULLANIN!\033[0m"
echo ""
echo -e "\033[1;31mâ—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ã…¤ðŸ‰ã…¤Cyux VPS YÃ¶neticisiã…¤ðŸ‰ã…¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡\033[0m"
echo ""

# KullanÄ±cÄ±dan kurulum onayÄ± al.
echo -ne "\033[1;36mâ—‡ Devam etmek istiyor musunuz? [E/H]: \033[1;37m"; read x
[[ $x = @(h|H) ]] && exit

echo -e "\n\033[1;36mâ—‡ ANAHTAR KONTROL EDÄ°LÄ°YOR...(Bu Ä°ÅŸlem Biraz Zaman Alabilir, LÃ¼tfen Bekleyin!)\033[0m"
# ... (Anahtar doÄŸrulama iÅŸlemi) ...
verif_key

# ... (DiÄŸer baÅŸlangÄ±Ã§ ayarlarÄ±) ...

echo -e "\n\033[1;32mâ—‡ ANAHTAR GEÃ‡ERLÄ°!\033[1;32m"
sleep 1s
echo ""

# --- Mevcut KullanÄ±cÄ± VeritabanÄ± KontrolÃ¼ ---
[[ -f "$HOME/usuarios.db" ]] && {
    clear
    echo -e "\n\033[0;34mâ—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡\033[0m"
    echo ""
    echo -e "                 \033[1;33mâ€¢ \033[1;31mâ—‡ DÄ°KKAT!\033[1;33mâ€¢ \033[0m"
    echo ""
    echo -e "\033[1;33mBir KullanÄ±cÄ± VeritabanÄ± \033[1;32m(usuarios.db) \033[1;33mbulundu!"
    echo -e "KullanÄ±cÄ±larÄ±n eÅŸ zamanlÄ± baÄŸlantÄ± limitini koruyarak"
    echo -e "mevcut veritabanÄ±nÄ± tutmak mÄ±, yoksa yeni bir"
    echo -e "veritabanÄ± oluÅŸturmak mÄ± istersiniz?\033[0m"
    echo -e "\n\033[1;37m[\033[1;31m1\033[1;37m] \033[1;33mMevcut VeritabanÄ±nÄ± Koru\033[0m"
    echo -e "\033[1;37m[\033[1;31m2\033[1;37m] \033[1;33mYeni Bir VeritabanÄ± OluÅŸtur\033[0m"
    echo -e "\n\033[0;34mâ—‡â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‡\033[0m"
    echo ""
    tput setaf 2 ; tput bold ; read -p "SeÃ§enek ?: " -e -i 1 optiondb ; tput sgr0
} || {
    # Mevcut veritabanÄ± yoksa, varsayÄ±lan olarak yeni bir tane oluÅŸtur.
    awk -F : '$3 >= 500 { print $1 " 1" }' /etc/passwd | grep -v '^nobody' > $HOME/usuarios.db
}
[[ "$optiondb" = '2' ]] && awk -F : '$3 >= 500 { print $1 " 1" }' /etc/passwd | grep -v '^nobody' > $HOME/usuarios.db
clear

# --- Sistem GÃ¼ncelleme ve Paket Kurulumu ---
tput setaf 7 ; tput setab 4 ; tput bold ; printf '%35s%s%-18s\n' "â—‡ KURULUM Ä°Ã‡Ä°N BEKLEYÄ°N." ; tput sgr0
echo ""
echo -e "               \033[1;33m[\033[1;31m!\033[1;33m] \033[1;32mâ—‡ SÄ°STEM GÃœNCELLENÄ°YOR...\033[1;33m[\033[1;31m!\033[1;33m]\033[0m"
echo ""
echo -e "     \033[1;33mâ—‡ GÃœNCELLEMELER GENELLÄ°KLE BÄ°RAZ ZAMAN ALIR!\033[0m"
echo ""
fun_bar 'apt-get update'
clear
echo ""
echo -e "               \033[1;33m[\033[1;31m!\033[1;33m] \033[1;32mâ—‡ PAKETLER YÃœKLENÄ°YOR\033[1;33m[\033[1;31m!\033[1;33m] \033[0m"
echo ""
echo -e "\033[1;33mâ—‡ BAZI PAKETLERÄ°N YÃœKLENMESÄ° KESÄ°NLÄ°KLE GEREKLÄ°DÄ°R!\033[0m"
echo ""
inst_pct() {
    _pacotes=("bc" "apache2" "cron" "screen" "nano" "unzip" "lsof" "netstat" "net-tools" "dos2unix" "nload" "jq" "curl" "figlet" "python3" "python-pip")
    for _prog in ${_pacotes[@]}; do
        apt install $_prog -y
    done
    pip install speedtest-cli
}
fun_bar 'inst_pct'
# Gerekli portlar iÃ§in gÃ¼venlik duvarÄ± kurallarÄ±nÄ± ekle.
[[ -f "/usr/sbin/ufw" ]] && ufw allow 443/tcp ; ufw allow 80/tcp ; ufw allow 3128/tcp ; ufw allow 8799/tcp ; ufw allow 8080/tcp
clear

# --- Kurulumu Tamamlama ---
echo ""
echo -e "                 \033[1;33m[\033[1;31m!\033[1;33m] \033[1;32mâ—‡ BÄ°TÄ°RÄ°LÄ°YOR...\033[1;33m[\033[1;31m!\033[1;33m] \033[0m"
echo ""
echo -e "       \033[1;33mâ—‡ FONKSÄ°YONLAR VE AYARLAR TAMAMLANIYOR!\033[0m"
echo ""
# Gerekli modÃ¼lleri ve dosyalarÄ± indiren ana komutu Ã§alÄ±ÅŸtÄ±r.
fun_bar "$_Ink/list $_lnk $_Ink $_1nk $key"
clear
echo ""
IP=$(wget -qO- ipv4.icanhazip.com)
echo -e "        \033[1;33m \033[1;32mâ—‡ KURULUM TAMAMLANDI.â—‡\033[1;33m \033[0m"
echo ""
echo -e "\033[1;31m\033[1;33mâ—‡ ANA KOMUT:- \033[1;32mmenu\033[0m"
echo -e "\033[1;33mâ—‡ DAHA FAZLA BÄ°LGÄ° \033[1;31m(\033[1;36mâ—‡ TELEGRAM\033[1;31m): \033[1;37m@DRAGON_VPS_MANAGER \033[1;31m( \033[1;36m https://t.me/s/DRAGON_VPS_MANAGER \033[1;31m )\033[0m"
echo ""
echo -e "\033[1;31m \033[1;33mâ—‡--Ä°PUCU!--â—‡\033[1;36mã…¤--Bu URL'yi kullanarak sunucudaki Ã§evrimiÃ§i kullanÄ±cÄ± sayÄ±sÄ±nÄ± kolayca gÃ¶rebilirsiniz.\033[0m"
echo -e " http://$IP:8888/server/online"
echo ""
# Kurulum sonrasÄ± temizlik.
rm $HOME/hehe && cat /dev/null > ~/.bash_history && history -c